var O2 = require('o2');
var CONST = require('../data/consts.js');
var Effect = require('../Effects.js');
var Book = require('./Abstract/Book.js');
var u = require('../Utils.js');

/**
 * spell book of fireball
 * Ce sort lance une boule de feu de plasma surchauffé qui explose au moindre contact avec un mur
 * ou une creature. L'explosion provoque des dégats de zone à proximité du point d'impact
 * chaque creature toouchée ou prise dans la zone d'effet subit entre 30 et 60 points de degats
 * La boule de feu est repoussée par le "deflector" et attiré par le "magnet"
 */
var BookFireball = O2.extendClass(Book, {
	missileRef: 'p_fireball', // ce type de missile explose (défini par thinker)
	missiles: 1,
	cooldown: CONST.SPELL_DURATION_LEVEL[3],

	read: function(ctx) {
		var eDam = new Effect.Damage(u.rand(30, 60));
		this.curse(eDam);
	},

	// sera déclenchée une fois les missiles créé
	use: function(ctx) {
		O2.parent(this, ctx);
		if (ctx.missiles && ctx.missiles.length) {
			ctx.missiles.forEach(function(m) {
				m.setData('explosion', ['o_expfire', 'GXQuake']);
			});
		}
	}
});

module.exports = BookFireball;
