/**
 * Les livre de sorts ne disparaissent pas apres avoir été lu, mais ils ont un cooldown
 * un delai en deca duquel on ne peut pas relancer le sort
 */

var O2 = require('o2');
var Scroll = require('./Scroll.js');
var Effect = require('mwgame/Effects.js');

var Book = O2.extendClass(Scroll, {
	type: 'spellbook',
	cooldown: 5,
	_nTime: 0,
	_nTimeUntil: 0,
	
	
	clearCooldown: function() {
		this._nTimeUntil = 0;
	},

	checkCooldown: function(ctx) {
		this._nTime = ctx.time;
		if (ctx.time > this._nTimeUntil) {
			var nCDBonus = 100 - ctx.caster.getSoul().getAttribute('prof_cooldown');
			ctx.cooldown = this.cooldown * 10 * nCDBonus | 0;
			this._nTimeUntil = this._nTime + ctx.cooldown;
			return true;
		} else {
			ctx.fail = 'cooldown';
			ctx.cooldown = this._nTimeUntil - this._nTime;
			return false;
		}
	},
	
	use: function(ctx) {
		if (this.checkCooldown(ctx)) {
			O2.parent(this, ctx);
		}
		ctx.consume = false;
	},

	misuse: function(ctx) {
		if (this.checkCooldown(ctx)) {
			ctx.fail = 'misuse';
		}
		ctx.consume = false;
	}
});

module.exports = Book;
