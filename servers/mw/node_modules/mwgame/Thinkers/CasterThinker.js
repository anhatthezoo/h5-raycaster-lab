/**
 * Un thinker de base pour toute les cr√©atures avec une IA
 */
var O2 = require('o2');
var AggressiveThinker = require('./ShooterThinker.js');
var u = require('mwgame/Utils.js');

O2.extendClass('CasterThinker', ShooterThinker, {
	
	bCastSpell: true,
	
	thinkWait30: function() {
		if (this.testHostileVisible()) {
			this.bCastSpell = !this.bCastSpell; 
		}
		O2.parent(this);
	},
	
	
	thinkShoot_enter: function() {
		this.actionAim(); // we aim a last time
		if (this.bCastSpell) {
			this.actionCast(); // we cast a spell
			this.nShots = 1; // one cast only
		} else {
			this.actionAttack(); // we shoot
		}
		this.setActionTime(15); // 15 unit of time of recovery
	},
	
	actionCast: function() {
		var oEntity = this.oEntity;
		var oTarget = this.getTarget();
		if (oTarget) {
			a = this.getEntityAngle(oTarget);
			oEntity.setCourse(a);
			var oInv = oEntity.getData('inventory');
			if (oInv) {
				var iItem = u.rand(0, oInv.aBagSlots.length - 1);
				var oItem = oInv.aBagSlots[iItem];
				if (oItem) {
					this.oGame.entityUseItem(oEntity, iItem, true);
				}
			}
		}
	}
});

module.exports = CasterThinker;
