var O2 = require('o2');
var CONST = require('../data/consts.js');
var Effect = require('../Effects.js');
var Book = require('./Abstract/Book.js');
var u = require('../Utils.js');

/**
 * spell book of bounging orb
 * Lance une enorme boule de plasma qui rebondit contre les murs et tout autre obstacle.
 * Inflige 20 points de dégat à tout malheureux qui se trouve sur la trajectoire de la boule
 * La boule rebondissante est repoussée par le "deflector" et attiré par le "magnet"
 */
var BookBouncingorb = O2.extendClass(Book, {
	missileRef: 'p_bouncing',
	missiles: 1,
	cooldown: CONST.SPELL_DURATION_LEVEL[3],

	read: function(ctx) {
		// il est conseillé de ne mettre que des effets instantanés et sans contexte
		// car l'effet peut etre répété sur plusieur cible percutées.
		var eDam = new Effect.Damage(20);
		this.curse(eDam);
	},
	
	// sera déclenchée une fois les missiles créé
	use: function(ctx) {
		O2.parent(this, ctx);
		if (ctx.missiles && ctx.missiles.length) {
			ctx.missiles.forEach(function(m) {
				m.bInstable = false;
				m.bSlideWall = true;
				m.bBouncing = true;
				m.setData('reflected', true);
			});
		}
	}

});

module.exports = BookBouncingorb;
