var O2 = require('o2');
var Item = require('./Item.js');

/**
 * Arme de base de contact
 * Dispose d'un cooldown empeche les tirs trop rapprochÃ©s
 */
var Weapon = O2.extendClass(Item, {

	type: 'wand',
	missileRef: 'p_slash',

	_nLastUseTime: 0,

	cooldown: 100,

	cool: function(ctx) {
		var nCooldown = this.cooldown * (1 + ctx.caster.getSoul().getAttribute('cooldown') / 100) | 0;
		if (this._nLastUseTime + nCooldown > ctx.time) {
			// cooldown encore actif
			ctx.fail = 'cooldown';
			return false;
		} else {
			this._nLastUseTime = ctx.time;
			return true;
		}
	},
	
	fire: function(ctx) {
		var oInst = ctx.instance;
		var oMissile = oInst.shootMissile(ctx.caster, this.missileRef, 0);
		oMissile.setData('effects', []);
		ctx.missiles = [oMissile];
	}

});

module.exports = Weapon;
