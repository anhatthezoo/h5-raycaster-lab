var O2 = require('o2');
var Effect = require('./Abstract/Effect.js');

// Effet de dégât
O2.extendClass('ADV.Effect.Death', Effect, {
	
	__construct: function() {
		O2.parent(this, 'Death', 'curse');
		this.setLevel(100);
	},
	
	cast: function(ep) {
		var oEntity = this.getTarget();
		var oSoul = oEntity.getSoul();
		var nAmount = oSoul.getAttribute('vitality') - oSoul.getAttribute('damage');	
		nAmount = nAmount * this.getLevel() / 100 | 0;
		oSoul.setBonus('damage', nAmount);
		if (this.getSource()) {
			oEntity.setData('aggressor', this.getSource());
		} else {
			oEntity.setData('aggressor', null);
		}
		if (oSoul.getAttribute('damage') >= oSoul.getAttribute('vitality')) {
			if (!oSoul.getAttribute('immortal')) {
				oSoul.setAttribute('dead', 1);
			}
		}
	}
});

module.exports = ADV.Effect.Death;
