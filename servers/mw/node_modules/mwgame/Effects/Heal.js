var O2 = require('o2');
var Effect = require('./Abstract/Effect.js');


// Effet de soin
O2.extendClass('ADV.Effect.Heal', Effect, {
	
	__construct: function(n) {
		O2.parent(this, 'Heal', 'bless');
		this.setLevel(n);
	},
	
	cast: function(ep) {
		oEntity = this.getTarget();
		var oSoul = oEntity.getSoul();
		// dead ?
		if (oSoul.getAttribute('dead') > 0) {
			return;
		}
		// pharma / illness
		var nAmount = this.getLevel() * (1 + oSoul.getAttribute('pharma') / 100) | 0;
		nAmount = Math.min(nAmount, oSoul.getAttribute('damage'));
		oSoul.setBonus('damage', -nAmount);
	},
	
	run: function(ep) {
		this.cast(ep);
	}
});

module.exports = ADV.Effect.Heal;
