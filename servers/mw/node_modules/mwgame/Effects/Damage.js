var O2 = require('o2');
var Effect = require('./Abstract/Effect.js');

// Effet de dégât
O2.extendClass('ADV.Effect.Damage', Effect, {
	
	__construct: function(n) {
		O2.parent(this, 'Damage', 'curse');
		this.setLevel(n);
	},
	
	cast: function(ep) {
		var oEntity = this.getTarget();
		var oSoul = oEntity.getSoul();
		var nAmount = this.getLevel();
		oSoul.setBonus('damage', nAmount);
		if (this.getSource()) {
			oEntity.setData('aggressor', this.getSource());
		} else {
			oEntity.setData('aggressor', null);
		}
		if (oSoul.getAttribute('damage') >= oSoul.getAttribute('vitality')) {
			if (!oSoul.getAttribute('immortal')) {
				oSoul.setAttribute('dead', 1);
			}
		}
	},

	run: function(ep) {
		this.cast(ep);
	}
});

module.exports = ADV.Effect.Damage;
