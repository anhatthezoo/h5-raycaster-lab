var O2 = require('o2');
var CONST = require('../data/consts.js');
var Effect = require('../Effects.js');
var Scroll = require('./Abstract/Scroll.js');
var u = require('../Utils.js');

/**
 * Scroll of Summon monster:
 * Le lanceur de sort invoque une succube 
 */
var ScrollMonster = O2.extendClass(Scroll, {
	read: function(ctx) {
		var oInst = ctx.instance;
		var oCaster = ctx.caster;
		
		// trouver un points de spawn pour le monstre
		var xySpawn = oInst.getNearestSafeSector(oCaster.xSector, oCaster.ySector);
		var xSpawn = xySpawn.x;
		var ySpawn = xySpawn.y;
		var oSuccubus = oInst.createMonsterEntity('m_succubus', xSpawn, ySpawn, oCaster.a);
		oSuccubus.getThinker()._oMaster = oCaster;
		oCaster.setData('summoning', oSuccubus);
		oSuccubus.setData('summoner', oCaster);
		oInst.pushNetworkMessage(oInst.getClientEntities(), {
			m: 'vfx', 
			b: 'o_boom', 
			x: xSpawn * 64 + 32, 
			y: ySpawn * 64 + 32
		});
	}
});

module.exports = ScrollMonster;
