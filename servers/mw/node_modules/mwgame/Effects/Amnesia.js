var O2 = require('o2');
var Effect = require('./Abstract/Effect.js');

// Effet de cooldown des livre de sort
var ADV_Effect_Amnesia = O2.extendClass(Effect, {
	
	__construct: function() {
		O2.parent(this, 'Amnesia', 'curse');
	},
	
	cast: function(ep) {
		var oEntity = this.getTarget();
		var oInstance = oEntity.getThinker().oGame;
		if (oInstance === null) {
			return;
		}
		var oInventory = oEntity.getData('inventory');
		oInventory.aBagSlots.forEach(function(o, iItem) {
			if ((!!o) && (o.type === 'spellbook')) {
				var ctx = {
					time: Date.now(),
					cooldown: 0,
					fail: false					
				};
				o.clearCooldown();
				o.checkCooldown(ctx);
				oInstance.pushNetworkMessage([oEntity], {
					m: 'cooldown',
					n: ctx.cooldown,
					i: iItem
				});
			}
		});
	},
});

module.exports = ADV_Effect_Amnesia;
