var O2 = require('o2');
var Effect = require('./Abstract/Effect.js');

// Effet de purge des effets bénéfique
O2.extendClass('ADV.Effect.Remedy', Effect, {
	
	__construct: function(n) {
		O2.parent(this, 'Dispel', 'curse');
		this.setLevel(n);
	},
	
	cast: function(ep) {
		var nLevel = this.getLevel();
		this.getTarget()
			.getSoul()
			._aEffects
			.filter(function(e) {
				return e.hasTag('bless');
			})
			.slice(0, nLevel)
			.forEach(function(e) {
				e.dispel();
				--nLevel;
			});
		if (nLevel > 0) {
			this.getTarget()
			.getSoul()
			._aEffects
			.filter(function(e) {
				return e.hasTag('curse');
			})
			.slice(0, nLevel)
			.forEach(function(e) {
				e.dispel();
			});
		}
		ep.removeDeadEffects();
	},
});

module.exports = ADV.Effect.Remedy;
